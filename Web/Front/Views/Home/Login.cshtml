@using DotPay.Language
<h1>@Html.Lang("Login to your Account")</h1>

<div class="fail box" id="failBox" style="display:none;">
    <img src="~/public/images/error.png" alt="Error!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_error")!</strong><br><span id="spanFailBox"></span>
</div>
<div class="success box" id="sucessBox" style="@(!string.IsNullOrEmpty( ViewBag.ResetSuccess)?"": "display:none;")">
    <img src="~/public/images/success.png" alt="Success!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_success")!</strong><br><span id="spanSuccessBox">@ViewBag.ResetSuccess</span>
</div>

<form id="registerForm" autocomplete="off">
    @Html.AntiForgeryToken()
    <br>
    <table class="table register">
        <tbody>
            <tr>
                <th style="width:180px;">@Html.Lang("Email Address")</th>
                <td><input type="text" name="email" value=""></td>
            </tr>
            <tr>
                <th>@Html.Lang("Password")</th>
                <td><input type="password" id="password" name="password" value=""></td>
            </tr>
            <tr>
                <th>@Html.Lang("Open Auth")</th>
                <td>
                    <a class="qqlogin" href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=101081985&redirect_uri=http://www.fullcoin.com/qqlogin&state=fc&scope=get_user_info">
                        <span class="icon"></span>
                        <span style="font-style:normal">@Html.Lang("QQ")</span>
                    </a>
                    <a class="weibologin" href="https://api.weibo.com:443/oauth2/authorize?client_id=156073260&redirect_uri=http%3A%2F%2Fwww.fullcoin.com%2Fweibologin&response_type=code&display=default">
                        <span class="icon"></span>
                        <span style="font-style:normal">@Html.Lang("Weibo")</span>
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
    <br>
    <input type="submit" value="@Html.Lang("Login")">
    <br><br>
    <a href="/forgetPassword">@Html.Lang("Forgotten password")</a>
</form>

<script type="text/javascript">
    $(document).ready(function () {
        $("#registerForm").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/login?returnurl=@ViewBag.ReturnUrl',
                data: $(this).serialize(),
                success: function (data) {
                    if (data.Code == 1) {
                        window.location = ("@ViewBag.ReturnUrl".length > 0 ? "@ViewBag.ReturnUrl" : "/my/profile");
                    } else {
                        if (data.Code == 2) {
                            window.location = "/login/twofactor/" + data.Hash + ("@ViewBag.ReturnUrl".length > 0 ? '?ReturnUrl=' + "@ViewBag.ReturnUrl" : "");
                        } else {
                            $('#spanFailBox').html(data.Message);
                            $('#failBox').show();
                            $('#sucessBox').hide();
                            $('html, body').animate({
                                scrollTop: $("#failBox").offset().top - 95
                            }, 1000);
                            $('#password').val('');
                        }
                    }
                }
            });
        });
    });
</script>
