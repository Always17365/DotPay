 @using DotPay.Language
<h1>Login to your Account</h1>

<div class="fail box" id="failBox" style="@(string.IsNullOrEmpty( ViewBag.ErrorMessage)?"":"display:none;")">
    <img src="~/public/images/error.png" alt="Error!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_error")!</strong><br>
    <span id="spanFailBox">@ViewBag.ErrorMessage</span>
</div>
<div class="success box" id="sucessBox" style="@(string.IsNullOrEmpty(ViewBag.Message)?"":"display:none;")">
    <img src="~/public/images/success.png" alt="Success!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_success")!</strong><br>
    <span id="spanSuccessBox">@ViewBag.Message</span>
</div>

<form id="registerForm" autocomplete="off">
    @Html.AntiForgeryToken()
    <br>
    <table class="table register">
        <tbody>
            <tr>
                <th style="width:180px;">@Html.Lang("Email Address")</th>
                <td><input type="text" name="email" value=""></td>
            </tr>
            <tr>
                <th>@Html.Lang("Password")</th>
                <td><input type="password" id="password" name="password" value=""></td>
            </tr>
        </tbody>
    </table>
    <br>
    <input type="submit" value="@Html.Lang("Login")">
    <br><br>
    <a href="/forgetpassword">@Html.Lang("Forgotten password")</a>
</form>

<script type="text/javascript">
    $(document).ready(function () {
        $("#registerForm").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/login',
                data: $(this).serialize(),
                success: function (data) {
                    if (data.Code == 1) {
                        window.location = '/';
                    } else {
                        if (data.Code == 2) {
                            window.location = '/login/twofactor/' + data.Message + '';
                        } else {
                            $('#spanFailBox').html(data.Message);
                            $('#failBox').show();
                            $('#sucessBox').hide();
                            $('html, body').animate({
                                scrollTop: $("#failBox").offset().top - 95
                            }, 1000);
                            $('#password').val('');
                        }
                    }
                }
            });
        });
    });
</script>
