@using DotPay.Language
<h1>@Html.Lang("Forgotten password")</h1>
<div class="fail box" id="failBox" style="display:none;"><img src="/public/images/error.png" alt="Error!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_error")!</strong><br><span id="spanFailBox"></span></div>
<div class="success box" id="sucessBox" style="display:none;"><img src="/public/images/success.png" alt="Success!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_success")!</strong><br><span id="spanSuccessBox"></span></div>
 @Html.Lang("If you have forgotten your password, please fill out your email address below and follow the instructions emailed to you.")
<form id="registerForm">
    @Html.AntiForgeryToken()
    <br>
    <table class="table register">
        <tbody>
            <tr>
                <th style="width:180px;">@Html.Lang("Email Address")</th>
                <td><input type="text" name="email" value=""></td>
            </tr>
            <tr>
                <th style="width:180px;">@Html.Lang("Cpatcha")</th>
                <td>
                    <input name="checkcode" type="text" id="txt_checkcode" style="width:200px" class="text" /><a href="###" id="imglink"><img style="vertical-align:middle;margin-left:20px" src="/cci" /></a>                 
                </td>
            </tr>
        </tbody>
    </table>
    <br>
    <input type="submit" value="Reset Password">

</form>

<script type="text/javascript">
    $(document).ready(function () {
        $("#registerForm").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/forgetPassword',
                data: $(this).serialize(),
                success: function (data) {
                    if (data.Code == 1)
                        commonFormSuccessCallback(data);
                    else if (data.Code == 2)
                        window.location.href = "/resetLoginPasswordBy2FA/" + data.Hash;
                    else
                        commonFormFailCallback(data); 
                }, complete: function () {
                    $("#imglink").find("img").attr("src", "/cci?" + Math.random())
                }
            });
        });
        $("#imglink").click(function () {
            $(this).find("img").attr("src", "/cci?" + Math.random())
        }); 
    });
</script>