@using DotPay.Language
<div class="fail box" id="failBox" style="display:none;">
    <img src="~/public/images/error.png" alt="Error!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_error")!</strong><br><span id="spanFailBox"></span>
</div>
<div class="success box" id="sucessBox" style="display:none;">
    <img src="~/public/images/success.png" alt="Success!" class="left 2x" width="32"><strong>@Html.Lang("msg_box_success")!</strong><br><span id="spanSuccessBox"></span>
</div>
@if (ViewBag.Result.Code == 1)
{
    <h1>@Html.Lang("Reset Trade Password")</h1>
    @Html.Lang("Please enter a new trade password.")
    <form id="registerForm">
        @Html.AntiForgeryToken()
        <input type="hidden" name="token" value="@ViewData["resetTradePwdHash"]"> 
        <br>
        <table class="table register">
            <tbody>
                <tr>
                    <th>@Html.Lang("Trade Password")</th>
                    <td>
                        <input type="password" name="password" id="password" value=""><br>
                        <span>@Html.Lang("Please enter 6 characters minimum, including 1 or more digits.")</span>
                    </td>
                </tr>
                <tr>
                    <th>Confirm Trade Password</th>
                    <td>
                        <input type="password" name="confirmpassword" id="confirmpassword" value=""><br>
                        <span>@Html.Lang("Please type your trade password again.")</span>
                    </td>
                </tr>
                @if (ViewBag.CurrentUser.IsOpenTwoFactorGA)
                {
                    <tr>
                        <th>@Html.Lang("Google OTP")</th>
                        <td>
                            <input type="text" name="ga_Otp" id="ga_Otp_modifyPassword" value="" autocomplete="off"><br>
                        </td>
                    </tr>
                }
                @if (ViewBag.CurrentUser.IsOpenTwoFactorSMS)
                {
                    <tr>
                        <th>@Html.Lang("SMS OTP")</th>
                        <td>
                            <input type="text" name="sms_Otp" id="sms_Otp_modifyPassword" value="" autocomplete="off"><br>
                            <a id="btnSendSMSForResetTradePassword">@Html.Lang("Click here to get SMS Authentication Code")</a><br>
                        </td>
                    </tr>
                }

            </tbody>
        </table>

        <br>
        <input type="submit" value="@Html.Lang("Reset Trade Password")">
    </form>
}
else
{
    <h1>@ViewBag.Result.Message</h1>
}
<script src="~/public/js/jquery.validate.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        $("#registerForm").validate({
            rules: { 
                password: {
                    required: true,
                    minlength: 6
                },
                confirmpassword: {
                    required: true,
                    minlength: 6,
                    equalTo: "#password"
                } 
            },
            messages: { 
                password: {
                    required:  "@Html.Lang("Please provide a password")",
                    minlength: "@Html.Lang("Your password must be at least 6 characters long")"
                },
                confirmpassword: {
                    required:  "@Html.Lang("Please provide a password")",
                    minlength: "@Html.Lang("Your password must be at least 6 characters long")",
                    equalTo: "@Html.Lang("Please enter the same password as above")"
                }
            }
        });

        $("#btnSendSMSForResetTradePassword").click(function () {
            var btn = $(this);
            sendsms(btn, smsUseFor.ResetTradePwd);
        });

        $("#registerForm").submit(function (event) {
            event.preventDefault();
            if ($(this).valid()) {
                $.ajax({
                    type: 'POST',
                    url: '/resetTradePwdBy2TF',
                    data: $(this).serialize(),
                    success: function (data) {
                        commonFormCallback(data);
                    }
                });
            }
        });
    });
</script>
