@{
    Layout = null;
}
@using FC.Framework;
@using DotPay.ViewModel
@using DotPay.Common
@using DotPay.Language

@using DotPay.Language
<!DOCTYPE html>
<html lang="zh">
<head>
    <title>@Html.Lang("website_Title")</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="dotpay" name="keywords">
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="~/public/libs/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/public/css/profile.css" rel="stylesheet" />
    <!--[if IE 7]>
    <link rel="stylesheet" href="~/public/css/font-awesome-ie7.min.css">
    <![endif]-->
    <link href="~/public/css/layout.css" rel="stylesheet" />
    <script src="~/public/libs/jquery/jquery.min.js"></script>
    <script src="~/public/libs/jquery/jquery.cookie.js"></script>
    <script src="~/public/js/main.js"></script>
</head>
<body style="padding-bottom: 70px;">
    <header class="navbar navbar-static-top navbar-default  dotpay-navbar-profile-top" id="top" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".dotpay-navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <nav class="collapse navbar-collapse" role="navigation">
                <ul class="nav navbar-nav">
                    <li><a><i class="welcome">@Html.Lang("Dotpay,your fast payment expert")</i></a></li>
                </ul>
                <ul class="nav navbar-nav  navbar-right">
                    <li><a href="###" onclick="switchLang('zh-CN')">中文</a> </li>
                    <li><a href="###" onclick="switchLang('en-US')">English</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <nav class="navbar navbar-default dotpay-navbar-profile" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">
                    <img alt="Brand" style="height: 40px; width: 80px; display: inline" src="~/public/images/logo.png">
                </a> 
            </div>
            <nav class="collapse navbar-collapse" role="navigation"> 
                <ul class="nav navbar-nav ">
                    <li><a href="/deposit">充值查询</a></li>
                    <li><a href="/query">@Html.Lang("Direct transfer progress query")</a></li>
                </ul>
            </nav>
        </div>
    </nav>
    <div class="container">
        <div class="com-sm-12 col-md-10  col-md-offset-1 col-sm-offset-0">
            <div class="alert alert-info">
                @Html.LangAsHtmlString("Direct Transfer is a service provided by dotpay.co to enable rippletrade client users to pay to Alipay account or bank account in China directly.")<br>
                <label class="label label-info">@Html.Lang("Instruction")</label>:@Html.LangAsHtmlString("in rippletrade Recipient blank fill in {0} for paying to Alipay account or {1} for bank account, then follow the emerging instructions to fill in the next blanks and finally confirm the payment.", "<a href='https://rippletrade.com/#/send?to=alipay@dotpay.co' class='label label-success'>alipay@dotpay.co</a>", "<a href='https://rippletrade.com/#/send?to=bank@dotpay.co' class='label label-success'>bank@dotpay.co</a>")<br>
                <div class="alert-success" style="margin-top:15px;">
                    @Html.LangAsHtmlString("In work time the transfer will be done in no greater than 2 hours, if there is no delays caused by force majeures such as ripple system issues, alipay system issues or bank system issues.")<br>
                    @Html.Lang("Currently the Direct Transfer service is still in test phase,it's free and for each transfer the amount is limited to 1-1000CNY.")
                </div>
            </div>
            @if (string.IsNullOrEmpty(ViewBag.TxId))
            {
                <div class="panel panel-success">
                    <div class="panel-heading">@Html.Lang("Transfer query")</div>
                    <div class="panel-body">
                        <label id="lab_txid" style="display:none" class="label label-warning">@Html.Lang("Please input  your Ripple TxId")</label>
                        <form id="transferFrom" class="form-horizontal" role="form">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1">Ripple TxId</span>
                                <input id="txt_txid" type="text" class="form-control">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" id="btn_query" type="button">@Html.Lang("ripple_txid_query_btn_txt")</button>
                                </span>
                            </div>
                        </form>
                    </div>
                </div>
            }
            else
            {
                if (ViewBag.Transaction != null)
                {
                    var tx = (TransferTransaction)ViewBag.Transaction;
                    var tx_state = tx.State;
                    var payway = Html.Lang(PayWay.Alipay.ToString());

                    if (tx_state == TransactionState.Init || tx_state == TransactionState.Pending)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">@Html.Lang("Transfer Information")</div>
                            <div class="panel-body">
                                @Html.Lang("transfer {0} Yuan to {1} {2}", @tx.Amount.ToString(), @payway, @tx.Account) <label class="label label-info">@Html.Lang("ripple_query_status_Processing")</label>

                                @*当前时间，北京时间XX,我们在10:00-22:00会很快处理，在之外的时间会顺延至次日工作时间，敬请谅解*@

                            </div>
                        </div>
                    }
                    else if (tx_state == TransactionState.Success)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">@Html.Lang("Transfer Information")</div>
                            <div class="panel-body">
                                @Html.Lang("transfer {0} Yuan to {1} {2}", @tx.Amount.ToString(), @payway, @tx.Account) <label class="label label-info">@Html.Lang("ripple_query_status_Done")</label>

                                <br> @Html.Lang("alipay_transfer_no"):@tx.TransferNo
                            </div>
                        </div>
                    }
                    else if (tx_state == TransactionState.Fail)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">>@Html.Lang("Transfer Information")</div>
                            <div class="panel-body">
                                <div class="alert">
                                    @Html.Lang("transfer {0} Yuan to {1} {2}", @tx.Amount.ToString(), @payway, @tx.Account) <label class="label label-danger">@Html.Lang("ripple_query_status_Failed")</label>
                                </div>
                                <div class="alert alert-danger">
                                    @Html.LangAsHtmlString("Failed,Reason:{0}", @tx.Memo) <br />
                                    @Html.LangAsHtmlString("Please contact {0}  for next step processing", "<label class='label label-info'>support@dotpay.co</label>")
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="panel panel-success">
                        <div class="panel-heading">>@Html.Lang("Transfer query")</div>
                        <div class="panel-body">
                            <div class="alert alert-warning" role="alert">
                                @Html.Lang("ripple_query_not_exist")
                                <label class="label label-info">
                                    txid= @ViewBag.TxId
                                </label>
                            </div>
                            @Html.Lang("If you just created the transaction, please you 5 minutes before query")
                        </div>
                    </div>
                }
            }

            <div class="panel panel-info">
                <div class="panel-heading">
                    <h4 class="panel-title">@Html.Lang("Lastest Transfer Records")</h4>
                </div>
                <div class="panel-body" style="padding:0px;color:#555;font-size:12px;">
                    <table class="table table-striped table-responsive">
                        <tr>
                            <th>@Html.Lang("ripple_query_table_receiver_account")</th>
                            <th>@Html.Lang("ripple_query_table_processing_status")</th>
                            <th>@Html.Lang("ripple_query_table_create_at")</th>
                            <th>@Html.Lang("ripple_query_table_done_at")</th>
                            <th>@Html.Lang("ripple_query_table_amount")</th>
                            <th>@Html.Lang("ripple_query_table_transferno")</th>
                            <th>@Html.Lang("ripple_query_table_txid")</th>
                        </tr>
                        @foreach (var tx in (IEnumerable<TransferTransaction>)ViewBag.RecentlyTransaction)
                        {
                            var sub_transfer_length = Math.Max(tx.TransferNo.Length - 4, 1);
                            var sub_txid_length = Math.Max(tx.TxId.Length - 6, 1);
                            var account_is_email_style = tx.Account.Contains("@");
                            //var account_pre = account_is_email_style ? tx.Account.Split('@')[0] : tx.Account;
                            //var account_last = account_is_email_style ? "@" + tx.Account.Split('@')[1] : string.Empty;
                            var sub_account_length = Math.Min(tx.Account.Length, 4);
                            //var padright = Math.Max(account_pre.Length - sub_account_length, 1);
                            //var account_to_show = account_pre.Substring(0, sub_account_length).PadRight(padright, '*') + account_last;

                            var padleft = Math.Min(tx.Account.Length - sub_account_length, 3);
                            var account_to_show = tx.Account.Substring(tx.Account.Length - 4).PadLeft(tx.Account.Length, '*');
                            var payway = Html.Lang(tx.PayWay.ToString("F"));
                            <tr>
                                <td><label class="label label-info">@payway</label> @(account_to_show) </td>
                                @if (tx.State == TransactionState.Success)
                                {
                                    <td><label class='label label-success'>@Html.Lang("ripple_query_status_Done")</label></td>
                                }
                                else if (tx.State == TransactionState.Init || tx.State == TransactionState.Pending)
                                {
                                    <td> <label class='label label-info'>@Html.Lang("ripple_query_status_Processing")</label></td>
                                }

                                <td>@tx.CreateAt.ToLocalDateTime().ToString("MM-dd HH:mm")</td>
                                <td>@(tx.DoneAt > 0 ? tx.DoneAt.ToLocalDateTime().ToString("MM-dd HH:mm") : "")</td>
                                <td>@tx.Amount.ToString("0.00") @Html.Lang("Chinese_Yuan")</td>
                                <td>@(tx.State == TransactionState.Success ? ("****************" + tx.TransferNo.Substring(sub_transfer_length)) : "")</td>
                                <td>@("****************" + tx.TxId.Substring(sub_txid_length))</td>
                            </tr>
                        }
                    </table>
                </div>
            </div>

            <div class="panel">
                @*<div class="panel-body col-sm-3" style="padding:0px;color:#555;font-size:12px;">
                        <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=1161158822&site=qq&menu=yes">
                            <div class="btn btn-large btn-default">
                                <img src="~/public/images/qq.png" /><span>@Html.Lang("Contact us via QQ")</span>
                            </div>
                        </a>
                    </div>*@
                <div class="panel-body col-sm-4" style="padding:0px;color:#555;font-size:12px;">
                    <a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=8f8ed58718c5e89097afb76b6131994f4ba3ab680c454d64c21b080968f38bfe">
                        <div class="btn btn-large btn-default" style="text-align:left">
                            <img src="~/public/images/group.png" title="385108034" alt="385108034" />
                            <div style="display:inline-block; vertical-align:middle">
                                <span>@Html.Lang("Join QQ group Title")</span><br>
                                <span>@Html.Lang("Join QQ group")</span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="panel-body col-sm-4 " style="padding:0px;color:#555;font-size:12px;">
                    <a target="_blank" href="mailto:support@dotpay.co">
                        <div class="btn btn-large btn-default" style="text-align:left">
                            <img src="~/public/images/email.png" style="height: 60px;" />
                            <div style="display:inline-block;vertical-align:middle;">
                                <span>@Html.Lang("Support Email")</span><br>
                                <span>support@@dotpay.co</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () {
            $("#btn_query").click(function () {
                var txid = $("#txt_txid").val();

                if (txid) {
                    window.location.href = "/query/" + txid;
                }
                else
                    $("#lab_txid").show();

            })
        })
    </script>
    <footer id="footer" class="dotpay-footer navbar-fixed-bottom">
        <div>
            <div id="copyright">
                @Html.Lang("Copyright")
            </div>
        </div>
    </footer>
</body>
</html>
