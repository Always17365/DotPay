@{
    Layout = null;
}
@using FC.Framework;
@using DotPay.ViewModel
@using DotPay.Common
@using DotPay.Language

@using DotPay.Language
<!DOCTYPE html>
<html lang="zh">
<head>
    <title>@Html.Lang("website_Title")</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="dotpay" name="keywords">
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="~/public/libs/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/public/css/profile.css" rel="stylesheet" />
    <!--[if IE 7]>
    <link rel="stylesheet" href="~/public/css/font-awesome-ie7.min.css">
    <![endif]-->
    <link href="~/public/css/layout.css" rel="stylesheet" />
    <script src="~/public/libs/jquery/jquery.min.js"></script>
    <script src="~/public/libs/ripple/ripple-min.js"></script>
</head>
<body style="padding-bottom: 70px;">
    <header class="navbar navbar-static-top navbar-default  dotpay-navbar-profile-top" id="top" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".dotpay-navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <nav class="collapse navbar-collapse" role="navigation">
                <ul class="nav navbar-nav">
                    <li><a><i class="welcome">点付,您的快捷支付专家</i></a></li>
                </ul>
            </nav>
        </div>
    </header>
    <nav class="navbar navbar-default dotpay-navbar-profile" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="/my/index/">
                    <img alt="Brand" style="height:40px;width:80px;display:inline" src="~/public/images/logo.png">
                    <span>直通车转账进度查询</span>
                </a>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="com-sm-12 col-md-10  col-md-offset-1 col-sm-offset-0">
            <div class="alert alert-info">
                直通车是点付科技推出的由rippletrade客户端直接转账给支付宝账户的工具。<br>
                <label class="label label-info">操作方式说明</label>:在rippletrade收款账号栏里填入alipay@dotpay.co, 根据提示操作即可。<br>
                <div class="alert-success" style="margin-top:15px;">
                    工作时间内到账时间不超过1小时，如遇ripple系统问题，支付宝系统问题等不可抗力引起的延迟除外。<br>
                    目前点付直通车处于测试阶段，每笔转账限额1-200元（低于1元,目标账户待处理金额累计至1元后集中处理）。
                </div>
            </div>
            @if (string.IsNullOrEmpty(ViewBag.TxId))
            {
                <div class="panel panel-success">
                    <div class="panel-heading">转账查询</div>
                    <div class="panel-body">
                        <label id="lab_txid" style="display:none" class="label label-warning">请输入txid</label>
                        <form id="transferFrom" class="form-horizontal" role="form">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1">Ripple TxId</span>
                                <input id="txt_txid" type="text" class="form-control">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" id="btn_query" type="button">查询</button>
                                </span>
                            </div>
                        </form>
                    </div>
                </div>
            }
            else
            {
                if (ViewBag.Transaction != null)
                {
                    var tx = (TransferTransaction)ViewBag.Transaction;
                    var tx_state = tx.State;
                    var payway = tx.PayWay == PayWay.Alipay.ToString() ? "支付宝" : "财付通";

                    if (tx_state == TransactionState.Init || tx_state == TransactionState.Pending)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">转账信息</div>
                            <div class="panel-body">
                                转账 @tx.Amount 到 @payway : @tx.Account <label class="label label-info">处理中</label>

                                @*当前时间，北京时间XX,我们在10:00-22:00会很快处理，在之外的时间会顺延至次日工作时间，敬请谅解*@

                            </div>
                        </div>
                    }
                    else if (tx_state == TransactionState.Success)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">转账信息</div>
                            <div class="panel-body">
                                转账 @tx.Amount 到 @payway : @tx.Account <label class="label label-success">处理完毕</label>
                                <br> 支付宝交易号:@tx.TransferNo
                            </div>
                        </div>
                    }
                    else if (tx_state == TransactionState.Fail)
                    {
                        <div class="panel panel-success">
                            <div class="panel-heading">转账信息</div>
                            <div class="panel-body">
                                <div class="alert">
                                    转账 @tx.Amount 到 @payway : @tx.Account <label class="label label-danger">处理失败</label>
                                </div>
                                <div class="alert alert-danger">
                                    处理失败了,失败原因: @tx.Memo <br />
                                    请联系<label class="label label-info">support@@dotpay.co</label>，进行后续的处理
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="panel panel-success">
                        <div class="panel-heading">转账查询</div>
                        <div class="panel-body">
                            <div class="alert alert-warning" role="alert">
                                未查询该笔交易
                                <label class="label label-info">
                                    txid= @ViewBag.TxId
                                </label>
                            </div>
                            如果您刚刚创建了这个交易，请您5分钟之后再查询
                        </div>
                    </div>
                }
            }

            <div class="panel panel-info">
                <div class="panel-heading">
                    <h4 class="panel-title">最近的转账记录</h4>
                </div>
                <div class="panel-body" style="padding:0px;color:#555;font-size:12px;">
                    <table class="table table-striped table-responsive">
                        <tr>
                            <th>收款账号</th>
                            <th>处理状态</th>
                            <th>处理时间</th>
                            <th>金额</th>
                            <th>交易号</th>
                            <th>Ripple TxId</th>
                        </tr>
                        @foreach (var tx in (IEnumerable<TransferTransaction>)ViewBag.RecentlyTransaction)
                        {
                            var sub_transfer_length = Math.Max(tx.TransferNo.Length - 4, 1);
                            var sub_txid_length = Math.Max(tx.TxId.Length - 6, 1);
                            var account_is_email_style = tx.Account.Contains("@");
                            //var account_pre = account_is_email_style ? tx.Account.Split('@')[0] : tx.Account;
                            //var account_last = account_is_email_style ? "@" + tx.Account.Split('@')[1] : string.Empty;
                            var sub_account_length = Math.Min(tx.Account.Length, 4);
                            //var padright = Math.Max(account_pre.Length - sub_account_length, 1);
                            //var account_to_show = account_pre.Substring(0, sub_account_length).PadRight(padright, '*') + account_last;

                            var padleft = Math.Min(tx.Account.Length - sub_account_length, 3);
                            var account_to_show = tx.Account.Substring(tx.Account.Length - 4).PadLeft(tx.Account.Length, '*');
                            var payway = tx.PayWay == PayWay.Alipay.ToString() ? "支付宝" : "财付通";
                            <tr>
                                <td><label class="label label-info">@payway</label> @(account_to_show) </td>
                                @if (tx.State == TransactionState.Success)
                                {
                                    <td><label class='label label-success'>处理完毕</label></td>
                                }
                                else if (tx.State == TransactionState.Init || tx.State == TransactionState.Pending)
                                {
                                    <td> <label class='label label-info'>正在处理</label></td>
                                }
                                <td>@(tx.DoneAt > 0 ? tx.DoneAt.ToLocalDateTime().ToString("yyyy-MM-dd HH:mm") : "")</td>
                                <td>@tx.Amount 元</td>
                                <td>@(tx.State == TransactionState.Success ? ("****************" + tx.TransferNo.Substring(sub_transfer_length)) : "")</td>
                                <td>@("****************" + tx.TxId.Substring(sub_txid_length))</td>
                            </tr>
                        }
                    </table>
                </div>
            </div>

            <div class="panel">
                <div class="panel-body col-sm-3" style="padding:0px;color:#555;font-size:12px;">
                    <a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=1161158822&site=qq&menu=yes">
                        <div class="btn btn-large btn-default">
                            <img src="~/public/images/qq.png" /><span>点击联系QQ客服</span>
                        </div>
                    </a>
                </div>
                <div class="panel-body col-sm-3 " style="padding:0px;color:#555;font-size:12px;">
                    <a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=8f8ed58718c5e89097afb76b6131994f4ba3ab680c454d64c21b080968f38bfe">
                        <div class="btn btn-large btn-default">
                            <img src="~/public/images/group.png" title="385108034" alt="385108034" /><span>一键加入官方QQ群</span>
                        </div>
                    </a>
                </div>
                <div class=" panel-body col-sm-4 " style="padding:0px;color:#555;font-size:12px;">
                    <a target="_blank" href="mailto:support@dotpay.co">
                        <div class="btn btn-large btn-default">
                            <img src="~/public/images/email.png" /><span>支持邮箱 support@@dotpay.co</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () {
            $("#btn_query").click(function () {
                var txid = $("#txt_txid").val();

                if (txid) {
                    window.location.href = "/query/" + txid;
                }
                else
                    $("#lab_txid").show();

            })
        })
    </script>
    <footer id="footer" class="dotpay-footer navbar-fixed-bottom">
        <div>
            <div id="copyright">
                Copyright©2008-2014 All Rights Reserved 点付科技版权所有 |
                ICP备案：沪ICP备123456789号-2
            </div>
        </div>
    </footer>
</body>
</html>
